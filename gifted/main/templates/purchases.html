{% extends 'layout.html' %}

{% block title %}
purchases
{% endblock %}

{% block top_nav %}
<a class="nav-item nav-link" href="/">Events</a>
<span class="navbar-text">/</span>
<a class="nav-item nav-link" href="/events/{{ event.id }}">{{ event.title }}</a>
<span class="navbar-text">/</span>
<a class="nav-item nav-link active" href="#">My purchases</a>
{% endblock %}

{% block main %}
<div class="container">
    <div class="jumbotron">
        <h2>My Purchases</h2>
        {% if purchases|length == 0 %}
        <div>
            <p class="lead">You have not made any purchases...yet!</p>
        </div>
        {% else %}
        <div>
            <p class="lead">
                You have made {{ purchases|length }} purchase(s) totaling <strong>${{ liability }}.</strong>
            </p>
        </div>
        {% endif %}
    </div>

    {% for giftee, transactions in grouped_transactions.items() %}
    <div class="mb-4 border-bottom">
        <h5 class="font-italic">for: {{ giftee }}</h5>
        <div class="card-columns">
            {% for transaction in transactions %}
            <div class="card">
                <div class="card-header">
                    <p>{{ transaction.item.description }}</p>
                    <p class="card-subtitle text-muted">for {{ giftee }}</p>
                </div>
                <div class="card-body">
                    <h5 class="card-subtitle mb-2">${{ transaction.item.price }}</h5>
                    <form action="/events/{{ event.id }}/purchases/{{ session['user_id'] }}/delete" method="post">
                        <input type="hidden" id="purchase_id" name="purchase_id" value="{{ transaction.id }}">
                        <button class="btn btn-danger btn-sm" type="submit" onclick="return confirmDelete()">
                            Unclaim
                        </button>
                    </form>
                    <p class="card-text"><small class="text-muted">Claimed @ {{ transaction.transacted_on }}</small></p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
{% block bot_nav %}
<div class="container">
    <a href="/events/{{ event.id }}"><span>back to event</span></a>
</div>
{% endblock %}